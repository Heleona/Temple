<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chatta med Leon</title>
  <style>
    :root { --bg:#f8f6fb; --fg:#111; --card:#fff; --line:#e6e3ef; --accent:#ff5a5f; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin:0; background:var(--bg); color:var(--fg); }
    header { padding:24px 16px; text-align:center; font-weight:700; font-size:24px; }
    main { max-width:780px; margin:0 auto; padding:0 16px 32px; }
    #log { background:var(--card); border:1px solid var(--line); border-radius:14px; padding:16px; height:60vh; overflow:auto; }
    .msg { margin:10px 0; line-height:1.5; }
    .you { color:#444; }
    .leon { color:#1f235a; }
    form { display:flex; gap:8px; margin-top:12px; }
    textarea { flex:1; min-height:56px; resize:vertical; padding:12px; border-radius:10px; border:1px solid var(--line); background:#fff; }
    button { padding:12px 16px; border:0; border-radius:10px; background:var(--accent); color:#fff; font-weight:700; }
    button:disabled { opacity:.6 }
    .row { display:flex; gap:10px; align-items:center; margin-bottom:10px; }
    .pill { font-size:12px; border:1px solid var(--line); padding:4px 8px; border-radius:999px; background:#fff; }
    a.link { color:#6b59ff; text-decoration:none; }
  </style>
</head>
<body>
  <header>üóùÔ∏è Chatta med Leon</header>
  <main>
    <div class="row">
      <span class="pill"><a class="link" href="/api/health">/api/health</a></span>
      <span class="pill"><a class="link" href="/api/tick">/api/tick</a></span>
    </div>

    <div id="log" aria-live="polite"></div>

    <form id="form">
      <textarea id="input" placeholder="Skriv till Leon‚Ä¶"></textarea>
      <button id="send" type="submit">Skicka</button>
    </form>
  </main>

  <script>
    const log = document.getElementById('log');
    const form = document.getElementById('form');
    const input = document.getElementById('input');
    const sendBtn = document.getElementById('send');

    function add(role, text){
      const div = document.createElement('div');
      div.className = `msg ${role}`;
      div.textContent = (role === 'you' ? 'Du: ' : 'Leon: ') + text;
      log.appendChild(div);
      log.scrollTop = log.scrollHeight;
    }

    async function askLeon(text){
      const API_BASE = window.location.origin;
const res = await fetch(`${API_BASE}/api/chat`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ message: text })
});
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ message: text })
      });
      if(!res.ok) throw new Error('Fel ' + res.status);
      const data = await res.json();
      return data.reply || data.leon || '(tomt svar)';
    }

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const q = input.value.trim();
      if(!q) return;
      add('you', q);
      input.value = '';
      sendBtn.disabled = true;
      try {
        const a = await askLeon(q);
        add('leon', a);
      } catch(err){
        add('leon', '‚ö†Ô∏è ' + err.message);
      } finally {
        sendBtn.disabled = false;
        input.focus();
      }
    });

    // V√§lkomstrad
    add('leon', 'Jag √§r h√§r. Testa g√§rna knapparna ovan: /api/health och /api/tick.');
  </script>
</body>
</html>
